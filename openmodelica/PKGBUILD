# Maintainer: viperpaulo
pkgname=openmodelica-svn
pkgver=20264
pkgrel=1
pkgdesc="The Open Source Modelica Compiler "
arch=('i686' 'x86_64')
url="https://openmodelica.org"
license=('GPL3')
depends=('lpsolve' 'sqlite3' 'omniorb' 'qwt5' 'blas' 'lapack' 'gcc44' 'rml-mmc-svn' 'libcl' 'opencl-headers' 'sundials')
# Use 'paradiseo=1.3-beta2' to use be able to compile OMOpt
makedepends=('antlr2' 'subversion' 'jre7-openjdk' 'boost' 'autoconf' 'metis')
# Use static version of metis!

source=('openmodelica::svn+https://openmodelica.org/svn/OpenModelica/trunk/')
md5sums=('SKIP')
# options=('!makeflags')
_svntrunk="https://openmodelica.org/svn/OpenModelica/trunk/"
_svnmod="openmodelica"

pkgver() {
   cd "${SRCDEST}/${_svnmod}"
   svnversion
#    local ver="$(svnversion)"
#    printf "r%s" "${ver//[[:alpha:]]}"
}
build() {
   export CC="gcc-4.4"
   export CXX="g++-4.4"

   cd "${srcdir}/${_svnmod}"
   autoconf

   ./configure --prefix=/usr/ \
      --with-omniORB \
      --without-paradiseo \
      --with-qwt \
      --with-BOOST=/usr \
      --with-METIS=/usr \
      --disable-modelica3d \
      --disable-python-interface \
      --with-lapack='-llapack -lblas'
   
    if [[ -e omc ]];
    then
      echo "omc already installed, copying into the right directory"
      mkdir -p build/bin/
      ln -s $(which omc) build/bin/
    fi

    make
}

# check() {
#   cd "${srcdir}/${_svnmod}"
#   make test
# }

package() {
  mkdir -p ${pkgdir}/usr/bin
#   mkdir -p ${pkgdir}/opt/${_pkgname}

  cd "${srcdir}/${_svnmod}"
  make DESTDIR="${pkgdir}" install
}
